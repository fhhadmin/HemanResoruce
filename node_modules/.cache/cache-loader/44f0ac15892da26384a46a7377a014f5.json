{"remainingRequest":"D:\\Vue_WorkSpace\\hr-Admin\\HemanResoruce\\node_modules\\babel-loader\\lib\\index.js!D:\\Vue_WorkSpace\\hr-Admin\\HemanResoruce\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Vue_WorkSpace\\hr-Admin\\HemanResoruce\\src\\view\\messageAdd\\messageAdd.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\Vue_WorkSpace\\hr-Admin\\HemanResoruce\\src\\view\\messageAdd\\messageAdd.vue","mtime":1552902674681},{"path":"D:\\Vue_WorkSpace\\hr-Admin\\HemanResoruce\\.babelrc","mtime":1551258011000},{"path":"D:\\Vue_WorkSpace\\hr-Admin\\HemanResoruce\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1551930361523},{"path":"D:\\Vue_WorkSpace\\hr-Admin\\HemanResoruce\\node_modules\\babel-loader\\lib\\index.js","mtime":1526583314000},{"path":"D:\\Vue_WorkSpace\\hr-Admin\\HemanResoruce\\node_modules\\vue-loader\\lib\\index.js","mtime":1526010763000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.regexp.split\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { addCustomer, getCustomer, updateCustomer, addCusRemark, getListShop, getPageConsult, getPageCusFrom } from '@/api/makeAnAppointment/InformationEditing/InformationEditing';\nimport siteSelect from '@/components/siteSelect/siteSelect.vue';\nimport qiniuImg from '_c/qiniu-img';\nimport remark from './remark.vue';\nimport clickImg from '_c/clickImg';\nexport default {\n  data: function data() {\n    return {\n      modalValue: false,\n      modalModifyValue: false,\n      // 添加用户信息\n      loading: true,\n      cusName: '',\n      cusAge: 0,\n      cusBirthday: '',\n      cusPhone1: '',\n      cusPhone2: '',\n      cusGender: '',\n      constellation: '',\n      cusWechat: '',\n      cusQq: '',\n      cusFrom: '',\n      client: '',\n      //      orderNum: '',\n      consultType: '',\n      dealState: '',\n      city: [],\n      shopId: '',\n      remark: '',\n      vip: '',\n      pay: 0,\n      echoDataState: false,\n      isMessage: '',\n      valueTime: '',\n      valueData: '',\n      // 预约时间\n      dataTime: '',\n      rePic: [],\n      appointTime: '',\n      showAddData: false,\n      remarkAddState: 1,\n      modelShop: '',\n      shopList: [],\n      consultList: [],\n      visitTime: '',\n      sourcesList: [],\n      consumeState: '初诊',\n      isShop: '1'\n    };\n  },\n  props: {\n    stateEcho: {\n      type: Boolean,\n      default: false\n    },\n    size: {\n      type: String,\n      default: 'large'\n    },\n    userId: {\n      type: String,\n      default: ''\n    }\n  },\n  methods: {\n    modalOk: function modalOk() {\n      if (!this.cusName) {\n        this.$Message.error('姓名不能为空');\n        return;\n      } else if (!this.cusGender) {\n        this.$Message.error('请选择性别');\n        return;\n      } else if (!this.cusFrom) {\n        this.$Message.error('来源渠道不能为空');\n        return;\n      } else if (!this.consultType) {\n        this.$Message.error('咨询类别不能为空');\n        return;\n      } else if (!this.cusPhone1) {\n        this.$Message.error('电话1不能为空');\n        return;\n      }\n\n      if (this.cusName) {\n        var data = {};\n        data.cusName = this.cusName;\n        data.cusAge = this.cusAge;\n        this.cusBirthday ? data.cusBirthday = new Date(this.cusBirthday).Format('yyyy-M-d') : data.cusBirthday = '';\n        data.cusPhone1 = this.cusPhone1;\n        data.cusPhone2 = this.cusPhone2;\n        data.cusGender = this.cusGender;\n        data.cusWechat = this.cusWechat;\n        data.cusQq = this.cusQq;\n        data.cusFrom = this.cusFrom;\n        data.client = this.client; //        data.orderNum = this.orderNum\n\n        data.consultType = this.consultType;\n        data.dealState = this.dealState;\n        data.city = this.city[2];\n        data.shopId = this.shopId;\n        data.remark = this.remark;\n        data.vip = this.vip;\n        data.pay = this.pay;\n        data.isMessage = this.isMessage;\n        data.rePic = this.rePic;\n        data.shopId = this.modelShop;\n        data.consumeState = this.consumeState;\n        data.isShop = this.isShop;\n        this.visitTime ? data.visitTime = new Date(this.visitTime).Format('yyyy-M-d') : data.visitTime = '';\n        data.constellation = this.getConstellation(this.cusBirthday);\n\n        if (this.valueData && this.valueTime) {\n          data.appointTime = new Date(this.valueData).Format('yyyy-M-d') + ' ' + this.valueTime;\n        }\n\n        this.restoration();\n        this.modalValue = false;\n\n        if (this.echoDataState) {\n          this.upUser(data);\n        } else {\n          this.addUser(data);\n        }\n      } else {\n        this.modalValue = true;\n        this.$Message.error('请完善信息');\n        this.city = [];\n      }\n    },\n    getConstellation: function getConstellation(cusBirthday) {\n      if (!cusBirthday) {\n        return '';\n      }\n\n      var array1 = new Date(cusBirthday).Format('yyyy-M-d').split('-');\n      var month = array1[1];\n      var day = array1[2];\n      var s = '魔羯水瓶双鱼牡羊金牛双子巨蟹狮子处女天秤天蝎射手魔羯';\n      return s.substr(month * 2 - (day < '102223444433'.charAt(month - 1) - -19) * 2, 2);\n    },\n    modalCancel: function modalCancel() {\n      this.restoration();\n    },\n    // 复位\n    restoration: function restoration(data) {\n      this.cusName = '';\n      this.cusAge = 0;\n      this.cusBirthday = '';\n      this.cusPhone1 = '';\n      this.cusPhone2 = '';\n      this.cusGender = '';\n      this.cusWechat = '';\n      this.cusQq = '';\n      this.cusFrom = '';\n      this.client = ''; //      this.orderNum = ''\n\n      this.consultType = '';\n      this.shopTime = '';\n      this.dealState = '';\n      this.city = [];\n      this.shopId = '';\n      this.remark = '';\n      this.vip = '';\n      this.constellation = '';\n      this.pay = 0;\n      this.isMessage = '';\n      this.modelShop = '';\n      this.consumeState = '初诊';\n      this.isShop = '1';\n      this.visitTime = '';\n      this.rePic = [];\n      this.valueData = '';\n      this.valueTime = '';\n      this.appointTime = '';\n    },\n    // 添加顾客\n    addUser: function addUser(data) {\n      var _this = this;\n\n      addCustomer(data).then(function (res) {\n        _this.restoration();\n\n        _this.$Message.success(res.info);\n\n        _this.accomplish();\n      }).catch(function (err) {\n        _this.$Message.error(err);\n      });\n    },\n    // 修改顾客\n    upUser: function upUser(data) {\n      var _this2 = this;\n\n      updateCustomer(data, this.userId).then(function (res) {\n        _this2.restoration();\n\n        _this2.$Message.success(res.info);\n\n        _this2.accomplish();\n      }).catch(function (err) {\n        _this2.$Message.error(err);\n      });\n    },\n    // 回显\n    echoDataValue: function echoDataValue(data, msg) {\n      this.cusName = data.cusName;\n      this.cusAge = data.cusAge;\n      this.cusBirthday = data.cusBirthday;\n      this.cusPhone1 = data.cusPhone1;\n      this.cusPhone2 = data.cusPhone2;\n      this.cusGender = data.cusGender + '';\n      this.cusWechat = data.cusWechat;\n      this.cusQq = data.cusQq;\n      this.cusFrom = data.cusFrom;\n      this.client = data.client; //      this.orderNum = data.orderNum\n\n      this.consultType = data.consultType;\n      this.shopTime = data.shopTime;\n      this.dealState = data.dealState;\n      this.city = [msg.provinceId, msg.cityId, msg.id];\n      this.shopId = data.shopId;\n      this.remark = data.remark;\n      this.vip = data.vip + '';\n      this.pay = data.pay;\n      this.rePic = [];\n      this.isMessage = data.isMessage;\n      this.modelShop = data.shopId;\n      this.consumeState = data.consumeState;\n      this.isShop = data.isShop;\n      this.visitTime = data.visitTime;\n      this.valueData = data.appointTime.split(' ')[0];\n      this.valueTime = data.appointTime.split(' ')[1];\n    },\n    // 修改信息\n    echoData: function echoData() {\n      var _this3 = this;\n\n      this.modalValue = !this.modalValue;\n      this.showAddData = true;\n      getCustomer(this.userId).then(function (res) {\n        _this3.echoDataValue(res.info, res.msg);\n\n        _this3.echoDataState = true;\n      }).catch(function (err) {});\n    },\n    // 发送完成事件\n    accomplish: function accomplish() {\n      if (this.echoDataState) {\n        this.$emit('accomplish', true);\n      } else {\n        this.$emit('accomplish');\n      }\n    },\n    // 取消弹出\n    cancel: function cancel() {\n      this.showAddData = false;\n      this.modalValue = false;\n      this.restoration();\n    },\n    updateImg: function updateImg(e) {\n      this.rePic.push(e);\n    },\n    // 添加备注\n    remarkAdd: function remarkAdd() {\n      var _this4 = this;\n\n      if (!this.userId || !this.rePic) {\n        this.$Message.error('请填写备注');\n        return;\n      }\n\n      addCusRemark(this.userId, this.remark, this.rePic).then(function (res) {\n        _this4.$Message.success(res.info);\n\n        _this4.rePic = [];\n        _this4.remark = '';\n        _this4.remarkAddState++;\n      }).catch(function (err) {\n        _this4.$Message.error(err);\n      });\n    },\n    // 获取店铺id\n    getShopList: function getShopList() {\n      var _this5 = this;\n\n      this.shopList = [];\n      getListShop().then(function (res) {\n        res.info.map(function (item) {\n          _this5.shopList.push(item);\n        });\n      }).catch(function (err) {\n        console.log(err);\n      });\n    },\n    // 获取咨询类别\n    getConsult: function getConsult() {\n      var _this6 = this;\n\n      this.consultList = [];\n      getPageConsult().then(function (res) {\n        res.info.data.map(function (item) {\n          _this6.consultList.push(item);\n        });\n      }).catch(function (err) {});\n    },\n    // 获取来源渠道\n    gitSources: function gitSources() {\n      var _this7 = this;\n\n      getPageCusFrom().then(function (res) {\n        _this7.sourcesList = [];\n        res.info.data.map(function (item) {\n          _this7.sourcesList.push({\n            id: item.id + '',\n            name: item.name\n          });\n        });\n      }).catch(function (err) {\n        console.log(err);\n      });\n    }\n  },\n  components: {\n    siteSelect: siteSelect,\n    qiniuImg: qiniuImg,\n    remark: remark,\n    clickImg: clickImg\n  },\n  watch: {\n    'cusBirthday': function cusBirthday(e) {\n      this.constellation = this.getConstellation(e);\n    }\n  },\n  mounted: function mounted() {\n    this.restoration();\n  }\n};",{"version":3,"sources":["messageAdd.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+JA;AACA;AACA;AACA;AACA;AACA;wBAEA;;kBAEA;wBACA;AACA;eACA;eACA;cACA;mBACA;iBACA;iBACA;iBACA;qBACA;iBACA;aACA;eACA;cACA;AACA;mBACA;iBACA;YACA;cACA;cACA;WACA;WACA;qBACA;iBACA;iBACA;iBACA;AACA;gBACA;aACA;mBACA;mBACA;sBACA;iBACA;gBACA;mBACA;iBACA;mBACA;oBACA;cACA,AACA;AAzCA;AA0CA;;;YAGA;eACA,AACA;AAHA;;YAKA;eACA,AACA;AAHA;;YAKA;eACA,AACA,AACA;AAJA;AATA;;gCAeA;yBACA;4BACA;AACA;kCACA;4BACA;AACA;gCACA;4BACA;AACA;oCACA;4BACA;AACA;kCACA;4BACA;AACA;AACA;;wBACA;mBACA;4BACA;2BACA;iHACA;8BACA;8BACA;8BACA;8BACA;0BACA;4BACA;2BACA,QACA;;gCACA;8BACA;8BACA;2BACA;2BACA;wBACA;wBACA;8BACA;0BACA;2BACA;iCACA;2BACA;yGACA;wDACA;;8CACA;sFACA;AACA;;aACA;0BACA;;gCACA;sBACA;eACA;uBACA;AACA;aACA;0BACA;4BACA;oBACA;AACA;AACA;6DACA;wBACA;eACA;AACA;;kEACA;yBACA;uBACA;cACA;sFACA;AACA;wCACA;WACA;AACA;AACA;;qBAEA;oBACA;yBACA;uBACA;uBACA;uBACA;uBACA;mBACA;qBACA;oBACA,GAVA,CAWA;;yBACA;sBACA;uBACA;kBACA;oBACA;oBACA;iBACA;2BACA;iBACA;uBACA;uBACA;0BACA;oBACA;uBACA;mBACA;uBACA;uBACA;yBACA;AACA;AACA;;AACA;;4CACA;cACA;;mCACA;;cACA;8BACA;6BACA;AACA;AACA;AACA;;AACA;;4DACA;eACA;;oCACA;;eACA;8BACA;8BACA;AACA;AACA;AACA;;0BAEA;yBACA;8BACA;4BACA;4BACA;wCACA;4BACA;wBACA;0BACA;yBACA,OAVA,CAWA;;8BACA;2BACA;4BACA;mDACA;yBACA;yBACA;4BACA;sBACA;mBACA;4BACA;4BACA;+BACA;yBACA;4BACA;mDACA;mDACA;AACA;AACA;;AACA;;8BACA;yBACA;mDACA;2CACA;;+BACA;8BAEA,CACA;AACA;AACA;sCACA;8BACA;iCACA;aACA;mBACA;AACA;AACA;AACA;8BACA;yBACA;wBACA;WACA;AACA;qCACA;sBACA;AACA;AACA;;AACA;;uCACA;4BACA;AACA;AACA;;6EACA;oCACA;;uBACA;wBACA;eACA;8BACA;8BACA;AACA;AACA;AACA;;AACA;;sBACA;wCACA;qCACA;+BACA;AACA;8BACA;oBACA;AACA;AACA;AACA;;AACA;;yBACA;2CACA;0CACA;kCACA;AACA;8BAEA,CACA;AACA;AACA;;AACA;;2CACA;6BACA;0CACA;;0BAEA;uBACA,AACA;AAHA;AAIA;8BACA;oBACA;AACA;AACA,AACA;AA3OA;;AA6OA;AACA;AACA;AACA,AACA;AALA;;2CAOA;iDACA;AACA,AACA;AAJA;8BAKA;SACA;AACA;AApTA","file":"messageAdd.vue","sourceRoot":"src\\view\\messageAdd","sourcesContent":["<template>\n    <div>\n      <Button v-if=\"!stateEcho\" type=\"primary\" @click=\"modalValue = true, showAddData = true, getShopList(), getConsult(), gitSources()\">添加顾客</Button>\n      <Button :size='size' v-else type=\"primary\" @click=\"echoData(), getShopList(), getConsult(), gitSources()\">详情</Button>\n      <div v-if=\"showAddData\">\n        <Modal\n          v-model=\"modalValue\"\n          title=\"添加顾客信息\"\n          :loading=\"loading\"\n          @on-cancel=\"cancel\"\n          width=\"800\">\n          <div slot=\"footer\">\n            <Button type=\"text\" size=\"large\" @click=\"modalCancel\">重置</Button>\n            <Button type=\"primary\" size=\"large\" @click=\"modalOk\">确定</Button>\n          </div>\n            <Row class=\"m_left\">\n              <Col span=\"11\">\n                <div>\n                  <span>姓名:  </span><Input v-model=\"cusName\" placeholder=\"顾客姓名\" style=\"width:   200px\" />\n                  <div style=\"display: inline-block; line-height: 32px; height: 32px;\">\n                    <div style=\"color: red; font-size: 20px;\">*</div>\n                  </div>\n                </div>\n                <div>\n                  <span>性别:  </span>\n                  <RadioGroup v-model=\"cusGender\">\n                    <Radio label=\"0\">男</Radio>\n                    <Radio label=\"1\">女</Radio>\n                  </RadioGroup>\n                  <div style=\"display: inline-block; line-height: 32px; height: 32px;\">\n                    <div style=\"color: red; font-size: 20px;\">*</div>\n                  </div>\n                </div>\n                <div>\n                  <span>微信: </span><Input v-model=\"cusWechat\" placeholder=\"顾客微信\" style=\"width: 200px\"/>\n                </div>\n                <div>\n                  <span>QQ: </span><Input v-model=\"cusQq\" placeholder=\"顾客QQ\" style=\"width: 200px\"/>\n                </div>\n                <div>\n                  <span>来源渠道:  </span>\n                  <Select v-model=\"cusFrom\" style=\"width:  200px\">\n                    <Option v-for=\"(item, index) in sourcesList\" :value=\"item.id + ''\" :key=\"index\" >{{ item.name }}</Option>\n                  </Select>\n                  <div style=\"display: inline-block; line-height: 32px; height: 32px;\">\n                    <div style=\"color: red; font-size: 20px;\">*</div>\n                  </div>\n                </div>\n                <div>\n                  <span>咨询类别:  </span>\n                  <Select v-model=\"consultType\" style=\"width:  200px\">\n                     <Option v-for=\"(item, index) in consultList\" :key=\"index\" :value=\"item.id + ''\" >{{ item.name }}</Option>\n                  </Select>\n                  <div style=\"display: inline-block; line-height: 32px; height: 32px;\">\n                    <div style=\"color: red; font-size: 20px;\">*</div>\n                  </div>\n                </div>\n                <div>\n                  <span>所在区域:  </span>\n                  <siteSelect v-model='city'></siteSelect>\n                </div>\n                <div>\n                  <span>是否发送短信:  </span>\n                  <Select v-model=\"isMessage\" style=\"width:  200px\">\n                     <Option value=\"0\" >否</Option>\n                     <Option value=\"1\" >是</Option>\n                  </Select>\n                </div>\n                <div v-if=\"this.$store.state.user.access.indexOf('admin') !== -1\">\n                  <span>分配店铺:  </span>\n                  <Select v-model=\"modelShop\" filterable style=\"width:200px\">\n                    <Option v-for=\"(item, index) in shopList\" :value=\"item.id\" :key=\"index\">{{ item.shopName }}</Option>\n                  </Select>\n                  <div style=\"display: inline-block; line-height: 32px; height: 32px;\">\n                    <div style=\"color: red; font-size: 20px;\">*</div>\n                  </div>\n                </div>\n              </Col>\n              <Col span=\"2\"></Col>\n              <Col span=\"11\">\n                <div>\n                  <span>年龄:  </span><InputNumber v-model=\"cusAge\" placeholder=\"顾客年龄\" style=\"width:   200px\" />\n                </div>\n                <div>\n                  <span>生日:  </span><DatePicker v-model=\"cusBirthday\" placeholder=\"顾客生日\" style=\"width:   200px; margin-bottom:   0;\"></DatePicker>{{' '+constellation}}\n                </div>\n                <div>\n                  <span>电话1:  </span><Input v-model=\"cusPhone1\" placeholder=\"家庭电话\" style=\"width:   200px\" />\n                  <div style=\"display: inline-block; line-height: 32px; height: 32px;\">\n                    <div style=\"color: red; font-size: 20px;\">*</div>\n                  </div>\n                </div>\n                <div>\n                  <span>电话2:  </span><Input v-model=\"cusPhone2\" placeholder=\"私人电话\" style=\"width:   200px\" />\n                </div>\n                <!--<div>-->\n                  <!--<span>预约号:  </span><Input v-model=\"orderNum\" placeholder=\"预约号\" style=\"width:   200px;\"/>-->\n                <!--</div>-->\n                <div>\n                  <span>预约时间:  </span>\n                  <DatePicker v-model=\"valueData\" type=\"date\" placeholder=\"请选择日期\" style=\"width: 120px\"></DatePicker>\n                  <TimePicker v-model=\"valueTime\" placeholder=\"请选择时间\" style=\"width: 150px; margin-left: 5px\"></TimePicker>\n                </div>\n                <div>\n                  <span>客户端:  </span>\n                  <Select v-model=\"client\" style=\"width:  200px\">\n                     <Option value=\"pc\" >pc</Option>\n                     <Option value=\"安卓\" >安卓</Option>\n                     <Option value=\"苹果\" >苹果</Option>\n                  </Select>\n                </div>\n                <div>\n                  <span>\n                    顾客回访:\n                  </span>\n                  <DatePicker type=\"date\" v-model=\"visitTime\" placeholder=\"请输入回访时间\" style=\"width: 200px\"></DatePicker>\n                </div>\n              <div>\n                <span>顾客状态:  </span>\n                <RadioGroup v-model=\"consumeState\">\n                  <Radio label=\"初诊\">初诊</Radio>\n                  <Radio label=\"复诊\">复诊</Radio>\n                  <Radio label=\"再消费\">再消费</Radio>\n                </RadioGroup>\n              </div>\n              <div>\n                <span>到店状态:  </span>\n                <RadioGroup v-model=\"isShop\">\n                  <Radio label=\"1\">已到</Radio>\n                  <Radio label=\"0\">未到</Radio>\n                </RadioGroup>\n              </div>\n              </Col>\n            </Row>\n            <div v-if=\"!stateEcho\">\n              <span>顾客备注:  </span><Input v-model=\"remark\" placeholder=\"备注\" type=\"textarea\" style=\" display: inline-block\"/> <qiniuImg @updateImg=\"updateImg\">上传图片</qiniuImg>\n              <div>\n                <clickImg :rePic=\"rePic\"></clickImg>\n              </div>\n            </div>\n            <div v-if=\"stateEcho\">\n              <remark :userId=\"this.userId\" :memarkState=\"remarkAddState\">\n                <div style=\"margin-bottom: 5px\">\n                  <span>顾客备注:  </span></br><Input v-model=\"remark\" placeholder=\"备注\" type=\"textarea\" style=\"display: inline-block\"/>\n                  <div style=\"margin-top: 10px\">\n                    <qiniuImg @updateImg=\"updateImg\">上传图片</qiniuImg>\n                    <Button type=\"primary\" size=\"small\" style=\"margin-left: 5px\" @click=\"remarkAdd\">添加备注</Button>\n                  </div>\n                </div>\n                <div>\n                  <clickImg :rePic=\"rePic\"></clickImg>\n                </div>\n              </remark>\n            </div>\n          </Modal>\n      </div>\n    </div>\n</template>\n<script>\nimport { addCustomer, getCustomer, updateCustomer, addCusRemark, getListShop, getPageConsult, getPageCusFrom } from '@/api/makeAnAppointment/InformationEditing/InformationEditing'\nimport siteSelect from '@/components/siteSelect/siteSelect.vue'\nimport qiniuImg from '_c/qiniu-img'\nimport remark from './remark.vue'\nimport clickImg from '_c/clickImg'\nexport default({\n  data () {\n    return {\n      modalValue: false,\n      modalModifyValue: false,\n      // 添加用户信息\n      loading: true,\n      cusName: '',\n      cusAge: 0,\n      cusBirthday: '',\n      cusPhone1: '',\n      cusPhone2: '',\n      cusGender: '',\n      constellation: '',\n      cusWechat: '',\n      cusQq: '',\n      cusFrom: '',\n      client: '',\n      //      orderNum: '',\n      consultType: '',\n      dealState: '',\n      city: [],\n      shopId: '',\n      remark: '',\n      vip: '',\n      pay: 0,\n      echoDataState: false,\n      isMessage: '',\n      valueTime: '',\n      valueData: '',\n      // 预约时间\n      dataTime: '',\n      rePic: [],\n      appointTime: '',\n      showAddData: false,\n      remarkAddState: 1,\n      modelShop: '',\n      shopList: [],\n      consultList: [],\n      visitTime: '',\n      sourcesList: [],\n      consumeState: '初诊',\n      isShop: '1'\n    }\n  },\n  props: {\n    stateEcho: {\n      type: Boolean,\n      default: false\n    },\n    size: {\n      type: String,\n      default: 'large'\n    },\n    userId: {\n      type: String,\n      default: ''\n    }\n  },\n  methods: {\n    modalOk () {\n      if (!this.cusName) {\n        this.$Message.error('姓名不能为空')\n        return\n      } else if (!this.cusGender) {\n        this.$Message.error('请选择性别')\n        return\n      } else if (!this.cusFrom) {\n        this.$Message.error('来源渠道不能为空')\n        return\n      } else if (!this.consultType) {\n        this.$Message.error('咨询类别不能为空')\n        return\n      }else if (!this.cusPhone1) {\n        this.$Message.error('电话1不能为空')\n        return\n      }\n      if (this.cusName) {\n        let data = {}\n        data.cusName = this.cusName\n        data.cusAge = this.cusAge\n        this.cusBirthday ? data.cusBirthday = new Date(this.cusBirthday).Format('yyyy-M-d') : data.cusBirthday = ''\n        data.cusPhone1 = this.cusPhone1\n        data.cusPhone2 = this.cusPhone2\n        data.cusGender = this.cusGender\n        data.cusWechat = this.cusWechat\n        data.cusQq = this.cusQq\n        data.cusFrom = this.cusFrom\n        data.client = this.client\n        //        data.orderNum = this.orderNum\n        data.consultType = this.consultType\n        data.dealState = this.dealState\n        data.city = this.city[2]\n        data.shopId = this.shopId\n        data.remark = this.remark\n        data.vip = this.vip\n        data.pay = this.pay\n        data.isMessage = this.isMessage\n        data.rePic = this.rePic\n        data.shopId = this.modelShop\n        data.consumeState = this.consumeState\n        data.isShop = this.isShop\n        this.visitTime ? data.visitTime = new Date(this.visitTime).Format('yyyy-M-d') : data.visitTime = ''\n        data.constellation = this.getConstellation(this.cusBirthday)\n        if (this.valueData && this.valueTime) {\n          data.appointTime = new Date(this.valueData).Format('yyyy-M-d') + ' ' + this.valueTime\n        }\n        this.restoration()\n        this.modalValue = false\n        if (this.echoDataState) {\n          this.upUser(data)\n        } else {\n          this.addUser(data)\n        }\n      } else {\n        this.modalValue = true\n        this.$Message.error('请完善信息')\n        this.city = []\n      }\n    },\n    getConstellation (cusBirthday) {\n      if (!cusBirthday) {\n        return ''\n      }\n      let array1 = new Date(cusBirthday).Format('yyyy-M-d').split('-')\n      let month = array1[1]\n      let day = array1[2]\n      let s = '魔羯水瓶双鱼牡羊金牛双子巨蟹狮子处女天秤天蝎射手魔羯'\n      return s.substr(month * 2 - (day < '102223444433'.charAt(month - 1) - -19) * 2, 2)\n    },\n    modalCancel () {\n      this.restoration()\n    },\n    // 复位\n    restoration (data) {\n      this.cusName = ''\n      this.cusAge = 0\n      this.cusBirthday = ''\n      this.cusPhone1 = ''\n      this.cusPhone2 = ''\n      this.cusGender = ''\n      this.cusWechat = ''\n      this.cusQq = ''\n      this.cusFrom = ''\n      this.client = ''\n      //      this.orderNum = ''\n      this.consultType = ''\n      this.shopTime = ''\n      this.dealState = ''\n      this.city = []\n      this.shopId = ''\n      this.remark = ''\n      this.vip = ''\n      this.constellation = ''\n      this.pay = 0\n      this.isMessage = ''\n      this.modelShop = ''\n      this.consumeState = '初诊'\n      this.isShop = '1'\n      this.visitTime = ''\n      this.rePic = []\n      this.valueData = ''\n      this.valueTime = ''\n      this.appointTime = ''\n    },\n    // 添加顾客\n    addUser (data) {\n      addCustomer(data).then(res => {\n        this.restoration()\n        this.$Message.success(res.info)\n        this.accomplish()\n      }).catch(err => {\n        this.$Message.error(err)\n      })\n    },\n    // 修改顾客\n    upUser (data) {\n      updateCustomer(data, this.userId).then(res => {\n        this.restoration()\n        this.$Message.success(res.info)\n        this.accomplish()\n      }).catch(err => {\n        this.$Message.error(err)\n      })\n    },\n    // 回显\n    echoDataValue (data, msg) {\n      this.cusName = data.cusName\n      this.cusAge = data.cusAge\n      this.cusBirthday = data.cusBirthday\n      this.cusPhone1 = data.cusPhone1\n      this.cusPhone2 = data.cusPhone2\n      this.cusGender = data.cusGender + ''\n      this.cusWechat = data.cusWechat\n      this.cusQq = data.cusQq\n      this.cusFrom = data.cusFrom\n      this.client = data.client\n      //      this.orderNum = data.orderNum\n      this.consultType = data.consultType\n      this.shopTime = data.shopTime\n      this.dealState = data.dealState\n      this.city = [msg.provinceId, msg.cityId, msg.id]\n      this.shopId = data.shopId\n      this.remark = data.remark\n      this.vip = data.vip + ''\n      this.pay = data.pay\n      this.rePic = []\n      this.isMessage = data.isMessage\n      this.modelShop = data.shopId\n      this.consumeState = data.consumeState\n      this.isShop = data.isShop\n      this.visitTime = data.visitTime\n      this.valueData = data.appointTime.split(' ')[0]\n      this.valueTime = data.appointTime.split(' ')[1]\n    },\n    // 修改信息\n    echoData () {\n      this.modalValue = !this.modalValue\n      this.showAddData = true\n      getCustomer(this.userId).then(res => {\n        this.echoDataValue(res.info, res.msg)\n        this.echoDataState = true\n      }).catch(err => {\n\n      })\n    },\n    // 发送完成事件\n    accomplish () {\n      if (this.echoDataState) {\n        this.$emit('accomplish', true)\n      } else {\n        this.$emit('accomplish')\n      }\n    },\n    // 取消弹出\n    cancel () {\n      this.showAddData = false\n      this.modalValue = false\n      this.restoration()\n    },\n    updateImg (e) {\n      this.rePic.push(e)\n    },\n    // 添加备注\n    remarkAdd () {\n      if (!this.userId || !this.rePic) {\n        this.$Message.error('请填写备注')\n        return\n      }\n      addCusRemark(this.userId, this.remark, this.rePic).then(res => {\n        this.$Message.success(res.info)\n        this.rePic = []\n        this.remark = ''\n        this.remarkAddState++\n      }).catch(err => {\n        this.$Message.error(err)\n      })\n    },\n    // 获取店铺id\n    getShopList () {\n      this.shopList = []\n      getListShop().then(res => {\n        res.info.map(item => {\n          this.shopList.push(item)\n        })\n      }).catch(err => {\n        console.log(err)\n      })\n    },\n    // 获取咨询类别\n    getConsult () {\n      this.consultList = []\n      getPageConsult().then(res => {\n        res.info.data.map(item => {\n          this.consultList.push(item)\n        })\n      }).catch(err => {\n\n      })\n    },\n    // 获取来源渠道\n    gitSources () {\n      getPageCusFrom().then(res => {\n        this.sourcesList = []\n        res.info.data.map(item => {\n          this.sourcesList.push({\n            id: item.id + '',\n            name: item.name\n          })\n        })\n      }).catch(err => {\n        console.log(err)\n      })\n    }\n  },\n  components: {\n    siteSelect,\n    qiniuImg,\n    remark,\n    clickImg\n  },\n  watch: {\n    'cusBirthday' (e) {\n      this.constellation = this.getConstellation(e)\n    }\n  },\n  mounted () {\n    this.restoration()\n  }\n})\n</script>\n<style>\n  .dataList div{\n    margin-bottom:   10px;\n  }\n  .m_left div {\n    margin-bottom:   5px;\n  }\n</style>\n"]}]}