{"remainingRequest":"D:\\Vue_WorkSpace\\sg-Admin\\node_modules\\babel-loader\\lib\\index.js!D:\\Vue_WorkSpace\\sg-Admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Vue_WorkSpace\\sg-Admin\\src\\view\\projectPlan\\planList.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\Vue_WorkSpace\\sg-Admin\\src\\view\\projectPlan\\planList.vue","mtime":1552557855013},{"path":"D:\\Vue_WorkSpace\\sg-Admin\\.babelrc","mtime":1551258011000},{"path":"D:\\Vue_WorkSpace\\sg-Admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1551930361523},{"path":"D:\\Vue_WorkSpace\\sg-Admin\\node_modules\\babel-loader\\lib\\index.js","mtime":1526583314000},{"path":"D:\\Vue_WorkSpace\\sg-Admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1526010763000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es6.promise\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport virtualList from 'vue-virtual-scroll-list';\nimport editableTables from '_c/editableTables/editableTables';\nimport { getProjectList as _getProjectList, getPageList } from '@/api/materialList/materialList';\nimport { addProPlan, getProPlan, materialQuery, addMaterial, getPlanMaterial } from '@/api/projectPlan/planList';\nexport default {\n  components: {\n    editableTables: editableTables,\n    virtualList: virtualList\n  },\n  data: function data() {\n    var _this = this;\n\n    return {\n      pageNum: 1,\n      totalPage: 1,\n      pageSize: 10,\n      loading: false,\n      isLoading: false,\n      materQuery: false,\n      addMaterial: false,\n      checked: false,\n      isLoad: false,\n      materLoading: false,\n      proName: '',\n      nid: '',\n      pId: '',\n      proId: '',\n      planId: '',\n      isTable: true,\n      projectList: [],\n      list: [],\n      tagList: [],\n      tagIdLIst: [],\n      materList: [],\n      columns: [{\n        title: '计划编号',\n        key: 'number',\n        align: 'center'\n      }, {\n        title: '计划时间',\n        key: 'planTime',\n        align: 'center'\n      }, {\n        title: '入场时间',\n        key: 'inTime',\n        align: 'center'\n      }, {\n        title: '操作',\n        key: 'action',\n        align: 'center',\n        render: function render(h, params) {\n          return 'div', [h('Button', {\n            props: {\n              type: 'info',\n              size: 'small'\n            },\n            style: {\n              marginRight: '10px'\n            },\n            on: {\n              click: function click() {\n                _this.isLoad = true;\n                _this.addMaterial = true;\n                _this.tagList = [];\n                _this.tagIdLIst = [];\n                _this.nid = params.row.nid;\n                _this.isTable = true;\n\n                _this.getMaterialList();\n              }\n            }\n          }, '添加材料'), h('Button', {\n            props: {\n              type: 'warning',\n              size: 'small'\n            },\n            style: {},\n            on: {\n              click: function click() {\n                _this.materQuery = true;\n                _this.planId = params.row.nid;\n                _this.materLoading = true;\n\n                _this.getMaterialQuery();\n              }\n            }\n          }, '查看')];\n        }\n      }],\n      dataList: [],\n      planMaterial: [{\n        title: '序号',\n        type: 'index',\n        align: 'center'\n      }, {\n        title: '材料名称',\n        key: 'materName',\n        align: 'center'\n      }, {\n        title: '材料规格',\n        key: 'materModel',\n        align: 'center'\n      }, {\n        title: '单位',\n        key: 'materUnit',\n        align: 'center'\n      }, {\n        title: \"项目总量\",\n        key: 'materNum',\n        align: 'center'\n      }, {\n        title: '计划数量',\n        key: 'planNum',\n        editable: true,\n        align: 'center'\n      }],\n      planMaterialList: [],\n      materQueryList: [{\n        title: '序号',\n        type: 'index',\n        align: 'center'\n      }, {\n        title: '材料名称',\n        key: 'materName',\n        align: 'center'\n      }, {\n        title: '材料规格',\n        key: 'materModel',\n        align: 'center'\n      }, {\n        title: '单位',\n        key: 'materUnit',\n        align: 'center'\n      }, {\n        title: \"项目总量\",\n        key: 'materNum',\n        align: 'center'\n      }, {\n        title: '计划数量',\n        key: 'planNum',\n        align: 'center'\n      }],\n      materialQueryList: []\n    };\n  },\n  methods: {\n    getPageNum: function getPageNum(e) {\n      this.pageNum = e;\n      this.getMaterialQuery();\n    },\n    addOk: function addOk() {\n      var _this2 = this;\n\n      var planList = {};\n      this.materList = [];\n      this.planMaterialList.map(function (item) {\n        planList.mId = item.mid;\n        planList.nId = _this2.nid;\n        planList.planNum = item.planNum;\n\n        _this2.materList.push(planList);\n      });\n      addMaterial(this.materList).then(function (res) {\n        if (res.info === '操作成功') {\n          console.log(res);\n          _this2.addMaterial = false;\n        } else {\n          _this2.$Message.error('添加失败!');\n        }\n      });\n    },\n    addCancel: function addCancel() {\n      this.addMaterial = false;\n    },\n    isClick: function isClick(e) {\n      var idList = [];\n\n      if (this.tagList.length === 0) {\n        this.tagList.push(e.trim().split(' ')[0]);\n        idList.push(e.trim().split(' ')[1]);\n      } else {\n        if (this.tagList.indexOf(e.trim().split(' ')[0]) === -1) {\n          this.tagList.push(e.trim().split(' ')[0]);\n          idList.push(e.trim().split(' ')[1]);\n        } else {\n          this.tagList.splice(this.tagList.indexOf(e.trim().split(' ')[0]), 1);\n          idList.splice(idList.indexOf(e.trim().split(' ')[1]), 1);\n        }\n      }\n\n      this.tagIdLIst = idList;\n    },\n    // 获取项目列表\n    getProjectList: function getProjectList() {\n      var _this3 = this;\n\n      this.projectList = [];\n\n      _getProjectList(1, '100').then(function (res) {\n        if (res.status === 1) {\n          _this3.projectList = res.info.data;\n          _this3.proName = _this3.projectList.length === 0 ? '' : _this3.projectList[0].pId;\n        } else {\n          console.log('操作失败');\n        }\n      }).catch(function (err) {\n        console.log(err);\n      });\n    },\n    // 查询项目计划列表\n    getPageList: function getPageList() {\n      var _this4 = this;\n\n      this.loading = true;\n      getProPlan(this.proId, this.pageNum, 10).then(function (res) {\n        _this4.loading = false;\n        _this4.dataList = [];\n\n        if (res.info === \"暂无计划\") {\n          _this4.$Message.error('该项目暂无计划!');\n        } else {\n          _this4.dataList = res.info.data;\n          _this4.pageNum = res.info.pageTotal;\n        }\n      });\n      this.getMaterialList();\n    },\n    // 查询项目材料列表\n    getMaterialList: function getMaterialList() {\n      var _this5 = this;\n\n      this.list = [];\n      getPageList(1, this.proId).then(function (res) {\n        _this5.isLoad = false;\n\n        if (res.info === '暂无数据') {\n          _this5.$Message.error('暂无数据');\n        } else {\n          res.info.data.map(function (e) {\n            _this5.list.push(e);\n          });\n        }\n      });\n    },\n    // 生成用料表\n    generateTable: function generateTable() {\n      var _this6 = this;\n\n      if (this.tagIdLIst.length !== 0) {\n        materialQuery(this.tagIdLIst).then(function (res) {\n          _this6.isTable = false;\n          _this6.planMaterialList = res.info;\n        });\n      } else {\n        this.$Message.error('请先选择计划材料!');\n      }\n    },\n    // 保存编辑\n    getInput: function getInput(e) {\n      this.planMaterialList = e;\n    },\n    getMaterialQuery: function getMaterialQuery() {\n      var _this7 = this;\n\n      getPlanMaterial(this.planId, this.pageNum, this.pageSize).then(function (res) {\n        _this7.materLoading = false;\n\n        if (res.info.data) {\n          var dataList = {};\n          res.info.data.map(function (item) {\n            console.log(res.info);\n            dataList.materName = item.proMaterialDomain.materName;\n            dataList.materModel = item.proMaterialDomain.materModel;\n            dataList.materUnit = item.proMaterialDomain.materUnit;\n            dataList.materNum = item.proMaterialDomain.materNum;\n            dataList.planNum = item.planNum;\n            _this7.pageNum = res.info.pageTotal;\n\n            _this7.materialQueryList.push(dataList);\n          });\n        }\n      });\n    }\n  },\n  watch: {\n    'selectProject': function selectProject(e) {\n      this.pId = e;\n    },\n    'proName': function proName(e) {\n      this.proId = e;\n      this.getPageList();\n    }\n  },\n  mounted: function mounted() {\n    this.getProjectList(); // this.getPageList()\n  }\n};",{"version":3,"sources":["planList.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgEA;AACA;AACA;AACA;AACA;;AAGA;AACA,AACA;AAHA;;AAIA;;;eAEA;iBACA;gBACA;eACA;iBACA;kBACA;mBACA;eACA;cACA;oBACA;eACA;WACA;WACA;aACA;cACA;eACA;mBACA;YACA;eACA;iBACA;iBACA;;eAGA;aACA;eACA,AACA;AAJA,OADA;eAOA;aACA;eACA,AACA;AAJA;eAMA;aACA;eACA,AACA;AAJA;eAMA;aACA;eACA;2CACA;;;oBAIA;oBACA,AACA;AAHA;;2BAKA,AACA;AAFA;;sCAIA;+BACA;oCACA;gCACA;kCACA;uCACA;gCACA;;sBACA;AACA,AACA;AAVA;AARA,aAmBA;;oBAGA;oBACA,AACA;AAHA;mBAKA,AACA;;sCAEA;mCACA;0CACA;qCACA;;sBACA;AACA,AACA;AAPA;AARA,aAgBA,AACA,KAtCA;AAuCA,AACA,AACA;AA9CA;gBA+CA;;eAGA;cACA;eACA,AACA;AAJA,OADA;eAOA;aACA;eACA,AACA;AAJA;eAMA;aACA;eACA,AACA;AAJA;eAMA;aACA;eACA,AACA;AAJA;eAMA;aACA;eACA,AACA;AAJA;eAMA;aACA;kBACA;eACA,AACA,AACA;AANA;wBAOA;;eAGA;cACA;eACA,AACA;AAJA,OADA;eAOA;aACA;eACA,AACA;AAJA;eAMA;aACA;eACA,AACA;AAJA;eAMA;aACA;eACA,AACA;AAJA;eAMA;aACA;eACA,AACA;AAJA;eAMA;aACA;eACA,AACA,AACA;AALA;yBAMA,AACA;AAzJA;AA0JA;;uCAEA;qBACA;WACA;AACA;;AACA;;qBACA;uBACA;gDACA;4BACA;8BACA;gCACA;;8BACA;AACA;sDACA;iCACA;sBACA;+BACA;eACA;gCACA;AACA;AACA;AACA;oCACA;yBACA;AACA;iCACA;mBACA;;qCACA;8CACA;wCACA;aACA;iEACA;gDACA;0CACA;eACA;4EACA;gEACA;AACA;AACA;;uBACA;AACA;AACA;;AACA;;yBACA;;oDACA;8BACA;wCACA;wFACA;eACA;sBACA;AACA;8BACA;oBACA;AACA;AACA;AACA;;AACA;;qBACA;mEACA;yBACA;0BACA;;iCACA;gCACA;eACA;qCACA;oCACA;AACA;AACA;WACA;AACA;AACA;;AACA;;kBACA;qDACA;wBACA;;iCACA;gCACA;eACA;yCACA;6BACA;AACA;AACA;AACA;AACA;AACA;;AACA;;uCACA;0DACA;2BACA;wCACA;AACA;aACA;4BACA;AACA;AACA;AACA;mCACA;8BACA;AACA;;AACA;;oFACA;8BACA;;2BACA;yBACA;4CACA;4BACA;wDACA;yDACA;wDACA;uDACA;oCACA;sCACA;;0CACA;AACA;AACA;AACA;AACA,AACA;AAtHA;;+CAwHA;iBACA;AACA;mCACA;mBACA;WACA;AACA,AACA;AARA;;SAUA,iBADA,CAEA;AACA;AApSA","file":"planList.vue","sourceRoot":"src\\view\\projectPlan","sourcesContent":["<template>\n  <div>\n    <editableTables :columns=\"columns\" :value=\"dataList\" :isLoading=\"loading\" :selectShow=\"false\" style=\"width:800px;\">\n      <Select v-model=\"proName\" placeholder=\"选择项目\" style=\"width:200px;\">\n        <Option v-for=\"item in projectList\" :value=\"item.pId\" :key=\"item.pId\">{{item.pName}}</Option>\n      </Select>\n    </editableTables>\n    <Modal\n      v-model=\"addMaterial\"\n      title=\"添加材料计划\"\n      :mask-closable=\"false\"\n      :fullscreen=\"true\"\n      :scrollable=\"true\">\n      <div style=\"margin-left:200px;\">\n        <div style=\"border: 1px solid #e5e5e5;width:90%;height: 400px;margin-top:20px;\">\n          <div style=\"margin-top: -10px;margin-left:20px;font-size:16px;\">待选材料列表</div>\n          <div style=\"margin:100px;\" v-if=\"isLoad\">\n            <div style=\"margin-top:150px;margin-left:120px;\"><Spin size=\"small\"></Spin></div>\n            <Spin style=\"margin-top:-15px;margin-left:300px;\"></Spin>\n            <Spin style=\"margin-top:-25px;margin-left:550px;\" size=\"large\"></Spin>\n          </div>\n          <div style=\"margin:20px;\">\n            <template v-for=\"(item,index) in list\">\n              <Tag checkable @on-change=\"isClick(item.materName+item.materModel+ ' ' +item.mid)\" color=\"primary\" :name=\"item.materName\" :checked=\"checked\">{{item.materName}}({{item.materModel}})</Tag>\n            </template>\n          </div>\n        </div>\n        <div style=\"border: 1px solid #e5e5e5;width: 90%;height: 200px;margin-top:20px;\" v-if=\"isTable\">\n          <div style=\"margin-top: -10px;margin-left:20px;font-size:16px;\">已选列表</div>\n          <virtual-list :size=\"40\" :remain=\"8\">\n            <div style=\"margin:10px\">\n              <template v-for=\"(item,index) in tagList\">\n                <Tag color=\"red\">{{item}}</Tag>\n              </template>\n            </div>\n          </virtual-list>\n          <div style=\"position: fixed;bottom:220px;left:85.5%\"><Button type=\"info\" @click=\"generateTable\">生成用料表</Button></div>\n        </div>\n        <div style=\"margin-top:20px;\" v-else>\n          <!-- <virtual-list :size=\"40\" :remain=\"8\"> -->\n            <editableTables :columns=\"planMaterial\" :value=\"planMaterialList\" @input=\"getInput\" :selectShow=\"false\" :showPage=\"false\" :isLoading=\"isLoading\" style=\"width:90%;\"></editableTables>\n          <!-- </virtual-list> -->\n        </div>\n      </div>\n      <div slot=\"footer\">\n        <Button type=\"primary\" @click=\"addOk\">添加</Button>\n        <Button type=\"warning\" @click=\"addCancel\">取消</Button>\n      </div>\n    </Modal>\n    <Modal\n      title=\"计划材料详情\"\n      v-model=\"materQuery\"\n      :mask-closable=\"false\"\n      :width=\"900\">\n      <virtual-list :size=\"40\" :remain=\"8\">\n        <editableTables :columns=\"materQueryList\" :pageTotal=\"totalPage\" :value=\"materialQueryList\" :selectShow=\"false\" @getPage=\"getPageNum\" :isLoading=\"materLoading\">\n          <Button type=\"primary\" style=\"margin-left:708px\">导出</Button>\n        </editableTables>\n      </virtual-list>\n    </Modal>\n  </div>\n</template>\n\n<script>\nimport virtualList from 'vue-virtual-scroll-list'\nimport editableTables from '_c/editableTables/editableTables'\nimport { getProjectList, getPageList } from '@/api/materialList/materialList'\nimport { addProPlan, getProPlan, materialQuery, addMaterial, getPlanMaterial } from '@/api/projectPlan/planList'\nexport default {\n  components:{\n    editableTables,\n    virtualList\n  },\n  data(){\n    return{\n      pageNum: 1,\n      totalPage: 1,\n      pageSize: 10,\n      loading: false,\n      isLoading: false,\n      materQuery: false,\n      addMaterial: false,\n      checked: false,\n      isLoad: false,\n      materLoading: false,\n      proName: '',\n      nid: '',\n      pId: '',\n      proId: '',\n      planId: '',\n      isTable: true,\n      projectList: [],\n      list: [],\n      tagList: [],\n      tagIdLIst: [],\n      materList: [],\n      columns: [\n        {\n          title: '计划编号',\n          key: 'number',\n          align: 'center'\n        },\n        {\n          title:'计划时间',\n          key: 'planTime',\n          align: 'center'\n        },\n        {\n          title: '入场时间',\n          key: 'inTime',\n          align:'center'\n        },\n        {\n          title: '操作',\n          key: 'action',\n          align: 'center',\n          render:(h,params) => {\n            return ('div',[\n              h('Button', {\n                props: {\n                  type: 'info',\n                  size: 'small'\n                },\n                style: {\n                  marginRight: '10px'\n                },\n                on:{\n                  click:() => {\n                    this.isLoad = true\n                    this.addMaterial = true\n                    this.tagList = []\n                    this.tagIdLIst = []\n                    this.nid = params.row.nid\n                    this.isTable = true\n                    this.getMaterialList()\n                  }\n                }\n              }, '添加材料'),\n              h('Button', {\n                props: {\n                  type: 'warning',\n                  size: 'small'\n                },\n                style: {\n\n                },\n                on:{\n                  click:() => {\n                    this.materQuery = true\n                    this.planId = params.row.nid\n                    this.materLoading = true\n                    this.getMaterialQuery()\n                  }\n                }\n              }, '查看'),\n            ])\n          }\n        }\n      ],\n      dataList: [],\n      planMaterial: [\n        {\n          title: '序号',\n          type: 'index',\n          align: 'center'\n        },\n        {\n          title: '材料名称',\n          key: 'materName',\n          align: 'center'\n        },\n        {\n          title: '材料规格',\n          key: 'materModel',\n          align: 'center'\n        },\n        {\n          title: '单位',\n          key: 'materUnit',\n          align: 'center'\n        },\n        {\n          title: \"项目总量\",\n          key: 'materNum',\n          align: 'center'\n        },\n        {\n          title: '计划数量',\n          key: 'planNum',\n          editable: true,\n          align: 'center'\n        }\n      ],\n      planMaterialList: [],\n      materQueryList: [\n        {\n          title: '序号',\n          type: 'index',\n          align: 'center'\n        },\n        {\n          title: '材料名称',\n          key: 'materName',\n          align: 'center'\n        },\n        {\n          title: '材料规格',\n          key: 'materModel',\n          align: 'center'\n        },\n        {\n          title: '单位',\n          key: 'materUnit',\n          align: 'center'\n        },\n        {\n          title: \"项目总量\",\n          key: 'materNum',\n          align: 'center'\n        },\n        {\n          title: '计划数量',\n          key: 'planNum',\n          align: 'center'\n        }\n      ],\n      materialQueryList: []\n    }\n  },\n  methods: {\n    getPageNum(e) {\n      this.pageNum = e\n      this.getMaterialQuery()\n    },\n    addOk() {\n      let planList = {}\n      this.materList = []\n      this.planMaterialList.map(item => {\n        planList.mId = item.mid\n        planList.nId = this.nid\n        planList.planNum = item.planNum\n        this.materList.push(planList)\n      })\n      addMaterial(this.materList).then(res => {\n        if (res.info === '操作成功') {\n          console.log(res)\n          this.addMaterial = false\n        }else{\n          this.$Message.error('添加失败!')\n        }\n      })\n    },\n    addCancel(){\n      this.addMaterial = false\n    },\n    isClick(e){\n      var idList = []\n      if (this.tagList.length === 0) {\n        this.tagList.push(e.trim().split(' ')[0])\n        idList.push(e.trim().split(' ')[1])\n      }else{\n        if(this.tagList.indexOf(e.trim().split(' ')[0]) === -1) {\n            this.tagList.push(e.trim().split(' ')[0])\n            idList.push(e.trim().split(' ')[1])\n        }else{\n          this.tagList.splice(this.tagList.indexOf(e.trim().split(' ')[0]), 1)\n         idList.splice(idList.indexOf(e.trim().split(' ')[1]), 1)\n        }\n      }\n      this.tagIdLIst = idList\n    },\n    // 获取项目列表\n    getProjectList() {\n      this.projectList = []\n      getProjectList( 1, '100').then(res => {\n        if(res.status === 1) {\n          this.projectList = res.info.data\n          this.proName = this.projectList.length === 0 ? '' : this.projectList[0].pId\n        }else{\n          console.log('操作失败')\n        }\n      }).catch(err => {\n        console.log(err)\n      })\n    },\n    // 查询项目计划列表\n    getPageList(){\n      this.loading = true\n      getProPlan(this.proId, this.pageNum, 10).then(res => {\n        this.loading = false\n        this.dataList = []\n        if(res.info === \"暂无计划\") {\n          this.$Message.error('该项目暂无计划!')\n        }else{\n          this.dataList = res.info.data\n          this.pageNum = res.info.pageTotal\n        }\n      })\n      this.getMaterialList()\n    },\n    // 查询项目材料列表\n    getMaterialList(){\n      this.list = []\n      getPageList(1,this.proId).then(res => {\n        this.isLoad = false\n        if(res.info === '暂无数据'){\n          this.$Message.error('暂无数据')\n        }else{\n          res.info.data.map(e => {\n            this.list.push(e)\n          })\n        }\n      })\n    },\n    // 生成用料表\n    generateTable(){\n      if(this.tagIdLIst.length !== 0) {\n        materialQuery(this.tagIdLIst).then(res => {\n          this.isTable = false\n          this.planMaterialList = res.info\n        })\n      }else{\n        this.$Message.error('请先选择计划材料!')\n      }\n    },\n    // 保存编辑\n    getInput(e){\n      this.planMaterialList = e\n    },\n    getMaterialQuery(){\n      getPlanMaterial(this.planId, this.pageNum, this.pageSize).then(res => {\n        this.materLoading = false\n        if(res.info.data){\n          let dataList = {}\n          res.info.data.map(item => {\n            console.log(res.info)\n            dataList.materName = item.proMaterialDomain.materName\n            dataList.materModel = item.proMaterialDomain.materModel\n            dataList.materUnit = item.proMaterialDomain.materUnit\n            dataList.materNum = item.proMaterialDomain.materNum\n            dataList.planNum = item.planNum\n            this.pageNum = res.info.pageTotal\n            this.materialQueryList.push(dataList)\n          })\n        }\n      })\n    }\n  },\n  watch:{\n    'selectProject'(e) {\n      this.pId = e\n    },\n    'proName'(e) {\n      this.proId = e\n      this.getPageList()\n    }\n  },\n  mounted() {\n    this.getProjectList()\n    // this.getPageList()\n  }\n}\n</script>\n\n<style>\n\n</style>\n"]}]}